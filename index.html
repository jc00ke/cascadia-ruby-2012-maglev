<!doctype html>  
<html lang="en">
	
	<head>
		<meta charset="utf-8">
		
		<title>Wouldn't you like to forget about the database?</title>

		<meta name="description" content="Cascadia Ruby 2012 session">
		<meta name="author" content="Jesse Cooke">

		<meta name="apple-mobile-web-app-capable" content="yes" />
		<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
		
		<link href='http://fonts.googleapis.com/css?family=Lato:400,700,400italic,700italic' rel='stylesheet' type='text/css'>
		
		<link rel="stylesheet" href="/css/reset.css">
		<link rel="stylesheet" href="/css/main.css">
		<link rel="stylesheet" href="/css/print.css" type="text/css" media="print">

		<link rel="stylesheet" href="/lib/css/zenburn.css" disabled>
		<link rel="stylesheet" href="/lib/css/github.css" disabled>
		<link rel="stylesheet" href="/lib/css/solarized_light.css" >
		<link rel="stylesheet" href="/lib/assets/styles.css">
	</head>                        
	                              
	<body>
		
		<div class="reveal">

			<!-- Used to fade in a background when a specific slide state is reached -->
			<div class="state-background"></div>
			
			<!-- Any section element inside of this container is displayed as a slide -->
			<div class="slides">
				<section>
					<h1>Wouldn't you like to forget about the database?</h1>
					<script>
						// Delicously hacky. Look away.
						if( navigator.userAgent.match( /(iPhone|iPad|iPod|Android)/i ) ) document.write( '<p style="color: rgba(0,0,0,0.3); text-shadow: none;">('+'Tap to navigate'+')</p>' );
					</script>
				</section>

        <section>
          <h1>Community</h1>
          <img src="/lib/assets/tenderlove.jpg" alt="Tenderlove being awesome" data-attribution="http://jakescruggs.blogspot.com/2010/06/rails-conf-2010-day-2.html" />
        </section>

        <section>
          <h1>Shoehorn</h1>
          <table class="relational-table">
            <thead>
              <tr>
                <th>ID</th>
                <th>Name</th>
                <th>Birthdate</th>
                <th>Email</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td>1</td>
                <td>Jesse Cooke</td>
                <td>9/28/1981</td>
                <td>jesse@jc00ke.com</td>
              </tr>
              <tr>
                <td>2</td>
                <td>Jon Doe</td>
                <td>6/23/1972</td>
                <td>jon@doe.name</td>
              </tr>
            </tbody>
          </table>
        </section>

        <section>
          <h2>Objects!</h2>
          <pre><code class="ruby"> 
Widget.find_by_name("foo")
# or
User.create({ email: "foo@bar.com" })
          </code></pre>

          <h2>Some Query Language :(</h2>
          <pre><code class="sql"> 
select * from widgets where name = 'foo';
# or
insert into users...
          </code></pre>
        </section>

        <section>
          <h2>Object-relational impedance mismatch</h2>
          <h3><a href="http://en.wikipedia.org/wiki/Object-relational_impedance_mismatch">Wikipedia</a></h3>
          <h3><a href="http://www.agiledata.org/essays/impedanceMismatch.html">Agile Data</a></h3>
          <h3><a href="http://c2.com/cgi/wiki?ObjectRelationalImpedanceMismatch">Cunningham &amp; Cunningham</a></h3>
          <h3><a href="http://www.codinghorror.com/blog/2006/06/object-relational-mapping-is-the-vietnam-of-computer-science.html">Coding Horror</a></h3>
        </section>

				<section>
          <img src="/lib/assets/smalltalk-byte-balloon.png" alt="Smalltalk" data-attribution="http://www.cc.kyoto-su.ac.jp/~atsushi/Smalltalkers/images/SmalltalkBalloon1998.jpg" />
				</section>

        <section data-state="alert">
          <h2>The Image</h2>
          <p>
            <img src="http://upload.wikimedia.org/wikipedia/commons/thumb/2/26/Plasma-lamp_2.jpg/474px-Plasma-lamp_2.jpg" alt="plasma lamp" />
            <!-- TODO: attribution - I, Luc Viatour [GFDL (http://www.gnu.org/copyleft/fdl.html), CC-BY-SA-3.0 (http://creativecommons.org/licenses/by-sa/3.0/) or CC-BY-SA-2.5-2.0-1.0 (http://creativecommons.org/licenses/by-sa/2.5-2.0-1.0)], via Wikimedia Commons
            http://commons.wikimedia.org/wiki/File%3APlasma-lamp_2.jpg -->
          </p>
          <aside class="notes">
            An image is where the objects live. They are persisted there. They aren't serialized into some other format &amp; stored somewhere else. They <em>live</em> there.
          </aside>
        </section>

        <section>
          <h3>A wise man once asked...</h3>
          <div class="fragment">
            <blockquote>
              How much do you think about saving your data instead of using it?
            </blockquote>
            <img src="/lib/assets/dale.jpg" alt="Dale Henrichs" />
            <h4><a href="http://gemstonesoup.wordpress.com/">Dale Henrichs</a></h4>
          </div>

          <aside class="notes">
            Ponytail!
          </aside>
        </section>

        <section>
          <h3>Time traveller</h3>
          <div class="fragment">
            <blockquote>
              The future of Ruby is here, itâ€™s just that we have it over in the Smalltalk world and you guys should come and get it.
            </blockquote>
            <img src="/lib/assets/avi.jpg" alt="Avi Bryant" />
            <h4><a href="http://about.me/avibryant">Avi Bryant</a></h4>
          </div>
        </section>

        <section>
          <p>
            <img src="https://github.com/MagLev/maglev.github.com/raw/master/images/maglev-logo.gif" />
          </p>
        </section>

        <section>
          <h2>Things we depend on</h2>
          <h3 class="fragment">&lt;nokogiri&gt;</h3>
          <h3 class="fragment">bcrypt</h3>
          <h3 class="fragment">{ json }</h3>
        </section>

        <section>
          <h1 class="emphasis">Transparent Object Persistence</h1>
          <div class="fragment">
            <blockquote>
              This is a fundamentally different way of approaching persistence, and it works.
            </blockquote>
            <h4><a href="http://about.me/avibryant">Avi Bryant</a></h4>
          </div>
        </section>
				































				<section>
					<h1>The Problem</h1>
          <table id="db_table">
            <tr>
              <td>
                <p class="fragment">PostgreSQL</p>
                <p class="fragment">MongoDB</p>
                <p class="fragment">MySQL</p>
              </td>
              <td class="right-align">
                <p class="fragment">ClearDB <span class="emphasis">o_O</span></p>
                <p class="fragment">JustOneDB <span class="emphasis">o_O</span></p>
                <p class="fragment">Xeround <span class="emphasis">o_O</span></p>
              </td>
            </tr>
          </table>

					<aside class="notes">
						You can't! While we hopefully design our data model to fit our object model, we often must do things that don't quite feel right in order to make the database work for us. And since we all have to deal with roflscale sites, we have to take into account other considerations, like sharding, durability, etc.
					</aside>
				</section>

        <section>
          <h1>What is it?</h1>
          <h2>It's like...</h2>
        </section>

        <section>
          <p>
            <img src="/lib/assets/cruby-logo.png" alt="CRuby" height="350" width="350" />
          </p>
        </section>

        <section>
          <p>
            <img src="/lib/assets/rbx-logo.png" alt="Rubinius" height="350" width="350" />
          </p>
        </section>

        <section>
          <p>
            <img src="/lib/assets/jruby-logo.png" alt="JRuby" />
          </p>
        </section>

        <section>
            <div class="equation">
              <h2>Smalltalk</h2>
              <h2>+ Perl</h2>
              <h2>+ Lisp</h2>
              <hr />
              <h2>Ruby</h2>
          </div>
          <aside class="notes">
            I like to think Smalltalk had a threesome with Perl &amp; Lisp and we got Ruby. So it's only natural that Ruby gets an image at some point.
          </aside>
        </section>

				<section>
					<blockquote cite="http://www.gemstone.com/products/gemstone">
            GemStone/S is the state-of-the-art platform for developing, deploying, and managing scalable, high-performance, multi-tier applications based on business <span class="emphasis">objects</span>.
					</blockquote>
					<p>
            <img src="/lib/assets/gemstone-s-logo.png" alt="GemStone/S" />
            <!-- TODO: attribution - http://www.gemstone.com/products/gemstone -->
					</p>
          <aside class="notes">
            From the MagLev site. Lots of buzzwords, and a lot of power in that last word.
          </aside>
				</section>

				<section>
					<h2>What's so special about Gemstone/S?</h2>
          <aside class="notes">
            If you remember Avi Bryant's keynote from RailsConf in 2007 (or if you've ever done any Smalltalk programming) you might have heard that Smalltalk &amp; Ruby are basically the same language. So a VM that's been tuned over decades to run Smalltalk fast could easily be adapted to run Ruby fast. Some micro-benchmarks have put MagLev on par with C. Caveat to benchmarks, but still, pretty impressive.
          </aside>
				</section>

				<section>
					<h2>What's so special about Gemstone/S?</h2>
					<ol>
            <li>Well-tuned VM to run Smalltalk</li>
					</ol>
          <aside class="notes">
            If you remember Avi Bryant's keynote from RailsConf in 2007 (or if you've ever done any Smalltalk programming) you might have heard that Smalltalk &amp; Ruby are basically the same language. So a VM that's been tuned over decades to run Smalltalk fast could easily be adapted to run Ruby fast. Some micro-benchmarks have put MagLev on par with C. Caveat to benchmarks, but still, pretty impressive.
          </aside>
				</section>

				<section>
					<h2>What's so special about Gemstone/S?</h2>
					<ol>
            <li class="faded">Well-tuned VM to run Smalltalk</li>
            <li>
              Battle-tested
              <ul>
                <li class="fragment">OOCL</li>
                <li class="fragment">National Slovenian Gas</li>
                <li class="fragment">JPMorgan Chase</li>
                <li class="fragment">Merril Lyn... haha just kidding</li>
                <li class="fragment">JACK IN THE BOX!</li>
              </ul>
            </li>
					</ol>
          <aside class="notes">
            Who uses the Smalltalk version?
            <p>OOCL (which you can find the whitepaper on the Seaside site TODO: link in resources) manages millions of shipping containers around the world with office scattered across the globe.</p>
            <p>The site ran for 10+ years continuously, which handled incorporating VAT, deregulations of EU energy market, a company split &amp; currency change to the Euro.</p>
          </aside>
				</section>

				<section>
					<h2>What's so special about Gemstone/S?</h2>
					<ol>
            <li class="faded">Well-tuned VM to run Smalltalk</li>
            <li class="faded">Battle-tested</li>
            <li class="emphasis">Transparent Object Persistence</li>
					</ol>
				</section>

        <section>
          <h2>MagLev</h2>
          <h3>Smalltalk image for Ruby</h3>
          <aside class="notes">
            We finally get to the shift in how we think about MagLev.
          </aside>
        </section>

        <section>
          <h1>MagLev</h1>
          <h2>Objects all the way down</h2>
          <p>
            <img src="/lib/assets/i-like-turtles.jpg" alt="I Like Turtles kid" />
          </p>
        </section>

				
				<section>
          <h1>Intervention Time</h1>
          <h2>Object Mappers are a crutch<span class="emphasis">*</span></h2>
          <aside class="notes">
            * I use them all the time. They're fantastic libraries of course, and we wouldn't be here without them. But, I'd argue that when you write code against an object mapper, you are subconsciously concerned with how the data is stored. There's a mismatch there which is unfortunate at best.
          </aside>
				</section>
				
				<section>
          <h1>ORM</h1>
					<h2>Object Relational Mapper</h2>
          <p>ActiveRecord</p>
          <p>Sequel</p>
          <p>DataMapper</p>
				</section>
				
				<section>
          <h1>ODM</h1>
					<h2>Object Document Mapper</h2>
          <p>Mongoid</p>
          <p>Ripple</p>
          <p>Couch... something</p>
				</section>
				
				<section>
          <h1>OHM</h1>
					<h2>Object Hash Mapper</h2>
          <p>Ohm</p>
				</section>

				<section>
					<h2>Ruby is all about objects, right?</h2>
          <img src="/lib/assets/fixie.jpg" alt="My first fixie, when it wasn't broken yet" />
          <aside class="notes">
            We regularly create &amp; destroy the "same" object.
            Analogy - put your bike in garage at night, take it apart. Put it back together in the morning. Someone wants to borrow it? You have to teach them how to disassemble &amp; reassemble too!
          </aside>
				</section>

        <section>
          <h2 class="emphasis">Transparent Object Persistence</h2>
          <pre><code class="ruby"> 
Maglev::PERSISTENT_ROOT
          </code></pre>

        </section>

        <section>
          <h2>How would you get the same object back when using an object mapper?</h2>
          <aside class="notes">
            Just because you get back an object with the same data does not make it the same object.
          </aside>
        </section>

        <section>
          <h1>Identity Map</h1>
          <aside class="notes">
            Take your typical web app where you're dealing with independent requests. How does the object mapping framework handle fetching the same object?
          </aside>
        </section>

        <section>
          <h2>ActiveRecord</h2>
          <pre><code class="ruby"> 
# config/application.rb
config.active_record.identity_map = true
          </code></pre>
        </section>

        <section>
          <h2>Sequel</h2>
          <pre><code class="ruby"> 
Sequel::Model.plugin :identity_map

Sequel::Model.with_identity_map do
  WickedCoolModel.first # ...
end

# or just on MySweetModel
MySweetModel.plugin :identity_map
          </code></pre>
        </section>

        <section>
          <h2>DataMapper</h2>
          <pre><code class="ruby"> 
# yay!
          </code></pre>
        </section>

        <section>
          <h2>Mongoid</h2>
          <pre><code class="ruby"> 
# config/mongoid.yml
identity_map_enabled: true

# or
Mongoid.identity_map_enabled = true
          </code></pre>
        </section>

        <section>
          <h1>MagLev</h1>
          <pre><code class="ruby"> 
# there's no such thing as an identity map!
          </code></pre>
        </section>

        <section>
          <h2>Simple Example</h2>
          <div>
            <pre><code class="ruby"> 
# VM #1
Maglev.abort_transaction
j = Object.new
j.object_id
# => 1234567
Maglev::PERSISTENT_ROOT[:jesse] = j
Maglev.commit_transaction
            </code></pre>
          </div>

          <div class="fragment">
            <pre><code class="ruby"> 
# VM #2
Maglev.abort_transaction
Maglev::PERSISTENT_ROOT[:jesse].object_id
# => 1234567
            </code></pre>
          </div>
        </section>

        <section>
          <h1>What is happening?</h1>
          <div class="fragment">
            <img src="/lib/assets/maglev-stone-diagram.png" />
          </div>
        </section>

        <section>
            <pre><code class="ruby"> 
Maglev.abort_transaction
            </code></pre>
          <div class="fragment">
            <img src="/lib/assets/maglev.abort_transaction.png" />
          </div>
        </section>

        <section>
            <pre><code class="ruby"> 
Maglev.commit_transaction
            </code></pre>
          <div class="fragment">
            <img src="/lib/assets/maglev.commit_transaction.png" />
          </div>
        </section>

        <section>
          <h2 class="emphasis">Persistence by Reachability</h2>
          <div class="fragment">
            <pre><code class="ruby"> 
# VM #1
Maglev.abort_transaction
cats = []
pierre = "Lucky Pierre"
cats << pierre
Maglev::PERSISTENT_ROOT[:cats] = cats
Maglev.commit_transaction
pierre.object_id
# => 9876543
            </code></pre>
          </div>

          <div class="fragment">
            <pre><code class="ruby"> 
# VM #2
Maglev.abort_transaction
Maglev::PERSISTENT_ROOT[:cats].first.object_id
# => 9876543
            </code></pre>
          </div>

          <aside class="notes">
            Those are the same string instances, even though we persisted the names array.
          </aside>
        </section>

        <section>
          <h3>What can you (easily) persist today?</h3>
          <p class="fragment">Arrays</p>
          <p class="fragment">Sets</p>
          <p class="fragment">Hashes</p>
          <p class="fragment">Counters</p>
          <p class="fragment">Sorted Sets</p>

          <aside class="notes">
            We already have arrays via associations. Sets via constraints. Hashes with pg's hstore. Counters via db locks &amp; Redis. Sorted Sets via Redis, scopes.
          </aside>
        </section>

        <section>
          <h3>Something more... exotic</h3>
          <div class="fragment">k-D Tree</div>
          <div class="fragment">Bloom Filter</div>
          <div class="fragment">Judy Array</div>
          <div class="fragment">
            <p>Leftist Tree</p>
            <img src="/lib/assets/leftist-tree.jpg" />
          </div>
          <!-- TODO: attribute - http://ronbosoldier.blogspot.com/2011/05/leftist-animal-rights-activists-peed-on.html -->
        </section>

        <section>
          <h1>A confession</h1>
          <h2 class="fragment">I <span class="emphasis">lied</span> about the whole "forget about the database" thing</h2>
        </section>

        <section>
          <h1>Decouple no more</h1>
          <h2 class="fragment">MagLev <span class="emphasis">becomes</span> your API</h2>
        </section>

        <section>
          <h1>I had a moment</h1>
          <img src="/lib/assets/aha.jpg" class="fragment" />
          <!-- TODO: attribute - http://audioporncentral.com/2008/10/a-ha-take-on-me-literal-video-version.html -->
        </section>

        <section>
          <h2>What I wanted to build</h2>
          <img class="fragment" src="/lib/assets/eqh-ideal.png" alt="Ideal EQH design" />
        </section>

        <section>
          <h2>What I ended up building</h2>
          <img class="fragment" src="/lib/assets/eqh-actual.png" alt="Actual EQH design" />
        </section>

        <section>
          <h2>What I could've built with MagLev</h2>
          <img class="fragment" src="/lib/assets/eqh-maglev.png" alt="MagLev EQH design" />
        </section>

        <section>
          <h2>Things that work</h2>

        </section>
				
			</div>

			<!-- The navigational controls UI -->
			<aside class="controls">
				<a class="left" href="#">&#x25C4;</a>
				<a class="right" href="#">&#x25BA;</a>
				<a class="up" href="#">&#x25B2;</a>
				<a class="down" href="#">&#x25BC;</a>
			</aside>

			<!-- Presentation progress bar -->
			<div class="progress"><span></span></div>
			
		</div>

		<script src="/lib/js/head.min.js"></script>

		<script>
			// Load reveal.js as well as a classList polyfill if needed
			head.js( !document.body.classList ? '/lib/js/classList.js' : null )
				.js( '/js/reveal.js', function() {

				// Parse the query string into a key/value object
				var query = {};
				location.search.replace( /[A-Z0-9]+?=(\w*)/gi, function(a) {
					query[ a.split( '=' ).shift() ] = a.split( '=' ).pop();
				} );

				// Fires when a slide with data-state=customevent is activated
				Reveal.addEventListener( 'customevent', function() {
					console.log( '"customevent" has fired' );
				} );

				// Fires each time a new slide is activated
				Reveal.addEventListener( 'slidechanged', function( event ) {
					// event.previousSlide, event.currentSlide, event.indexh, event.indexv
				} );

				// Full list of configuration options available here:
				// https://github.com/hakimel/reveal.js#configuration
				Reveal.initialize({
					controls: true,
					progress: true,
					history: true,
					
					theme: query.theme || 'default', // default/neon/beige
					transition: query.transition || 'concave' // default/cube/page/concave/linear(2d)
				});

			} );
			
			// Load highlight.js for syntax highlighting of code samples
			head.js( '/lib/js/highlight.js', function() { 
				hljs.initHighlightingOnLoad(); 
			} );

			// If we're runnning the notes server we need to include some additional JS
			// TODO Is there a better way to determine if we're running the notes server?
			if( window.location.host === 'localhost:1947' ) {
				head.js( 'socket.io/socket.io.js', '/plugin/speakernotes/client.js' );
			}
		</script>
		
	</body>
</html>
